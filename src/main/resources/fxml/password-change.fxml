<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.TextFlow?>
<?import javafx.scene.shape.Rectangle?>
<?import javafx.scene.shape.SVGPath?>

<VBox xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.cms.clubmanagementsystem.controller.PasswordChangeController"
      spacing="20" alignment="TOP_CENTER"
      stylesheets="@../css/password-change.css"
      styleClass="v-box">

    <!-- Header Section -->
    <VBox spacing="5" alignment="CENTER">
        <Label styleClass="header-label" text="Change Your Password"/>
        <Label styleClass="subtitle-label" text="Secure your account with a new password"/>
    </VBox>

    <!-- Warning Box -->
    <HBox styleClass="warning-box">
        <TextFlow>
            <Text text="First login detected: " style="-fx-font-weight: bold;"/>
            <Text text="You must change your temporary password before accessing the system."/>
        </TextFlow>
    </HBox>

    <!-- Form -->
    <VBox spacing="15" style="-fx-padding: 0 20;">
        <!-- Current Password -->
        <VBox spacing="5">
            <Label styleClass="form-label" text="Current Temporary Password"/>
            <HBox spacing="0">
                <PasswordField fx:id="currentPasswordField" promptText="Enter your temporary password" styleClass="password-field"/>
                <TextField fx:id="currentPasswordVisibleField" promptText="Enter your temporary password" styleClass="text-field" visible="false" managed="false"/>
                <Button styleClass="toggle-button" onAction="#togglePasswordVisibility">
                    <graphic>
                        <SVGPath content="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" />
                    </graphic>
                </Button>
            </HBox>
        </VBox>

        <!-- New Password -->
        <VBox spacing="5">
            <Label styleClass="form-label" text="New Password"/>
            <HBox spacing="0">
                <PasswordField fx:id="newPasswordField" promptText="Create a strong password" styleClass="password-field"/>
                <TextField fx:id="newPasswordVisibleField" promptText="Create a strong password" styleClass="text-field" visible="false" managed="false"/>
                <Button styleClass="toggle-button" onAction="#togglePasswordVisibility">
                    <graphic>
                        <SVGPath content="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" />
                    </graphic>
                </Button>
            </HBox>

            <!-- Password Strength Meter -->
            <HBox spacing="5" alignment="CENTER_LEFT">
                <Rectangle fx:id="strengthMeter" width="0" height="5" arcWidth="5" arcHeight="5" styleClass="strength-meter"/>
                <Rectangle width="100" height="5" arcWidth="5" arcHeight="5" fill="#e9ecef"/>
                <Rectangle width="100" height="5" arcWidth="5" arcHeight="5" fill="#e9ecef"/>
            </HBox>
        </VBox>

        <!-- Confirm Password -->
        <VBox spacing="5">
            <Label styleClass="form-label" text="Confirm New Password"/>
            <HBox spacing="0">
                <PasswordField fx:id="confirmPasswordField" promptText="Re-enter your new password" styleClass="password-field"/>
                <TextField fx:id="confirmPasswordVisibleField" promptText="Re-enter your new password" styleClass="text-field" visible="false" managed="false"/>
                <Button styleClass="toggle-button" onAction="#togglePasswordVisibility">
                    <graphic>
                        <SVGPath content="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" />
                    </graphic>
                </Button>
            </HBox>
        </VBox>

        <!-- Error Message -->
        <HBox fx:id="errorBox" alignment="CENTER_LEFT" spacing="5" styleClass="error-box" visible="false">
            <Label text="⚠" style="-fx-text-fill: #721c24;"/>
            <Label fx:id="errorLabel" styleClass="error-label" text="All fields are required"/>
        </HBox>

        <!-- Password Requirements -->
        <VBox spacing="10" styleClass="requirements-box">
            <Label text="Password Requirements:" styleClass="requirements-title"/>
            <HBox spacing="10">
                <VBox spacing="5">
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <Label fx:id="lengthIcon" text="○" styleClass="requirement-icon"/>
                        <Label text="8-64 characters" styleClass="requirement-text"/>
                    </HBox>
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <Label fx:id="upperIcon" text="○" styleClass="requirement-icon"/>
                        <Label text="1 uppercase letter" styleClass="requirement-text"/>
                    </HBox>
                </VBox>
                <VBox spacing="5">
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <Label fx:id="lowerIcon" text="○" styleClass="requirement-icon"/>
                        <Label text="1 lowercase letter" styleClass="requirement-text"/>
                    </HBox>
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <Label fx:id="numberIcon" text="○" styleClass="requirement-icon"/>
                        <Label text="1 number" styleClass="requirement-text"/>
                    </HBox>
                </VBox>
                <VBox spacing="5">
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <Label fx:id="specialIcon" text="○" styleClass="requirement-icon"/>
                        <Label text="1 special character" styleClass="requirement-text"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>

        <!-- Submit Button -->
        <Button styleClass="submit-button" text="Change Password" onAction="#handleChangePassword"/>
    </VBox>

    <!-- Footer -->
    <Label styleClass="footer-label" text="Club Management System © 2025 | Secure Authentication"/>
</VBox>